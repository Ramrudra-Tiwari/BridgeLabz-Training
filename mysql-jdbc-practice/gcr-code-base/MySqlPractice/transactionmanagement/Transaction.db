
/*
Exercise 2: Transaction Management
Implement a banking system with:
• Transfer money between accounts (use transactions)
• Check balance
• Transaction history
*/

-- Task 0 [CRATE DATABASE]

CREATE DATABASE bank_database;

USE bank_database;

-- accounts db table 
CREATE TABLE accounts(
    account_number INT AUTO_INCREMENT PRIMARY KEY,
    account_holder_name VARCHAR(50) NOT NULL,
    balance DECIMAL(10,2)
    );

--transaction db table
CREATE TABLE transaction(
    transaction_id INT AUTO_INCREMENT PRIMARY KEY,
    from_account INT,
    to_account INT,
    amount DECIMAL(10,2),
    transaction_date DATETIME DEFAULT CURRENT_TIMESTAMP
    );


-- Add account data 

INSERT INTO accounts
    (account_holder_name, balance)
    VALUES
    ('ravi', 2000),
    ('kali', 4000),
    ('allu', 8000);

SELECT * FROM accounts;

+----------------+---------------------+---------+
| account_number | account_holder_name | balance |
+----------------+---------------------+---------+
|              1 | ravi                | 2000.00 |
|              2 | kali                | 4000.00 |
|              3 | allu                | 8000.00 |
+----------------+---------------------+---------+


-- Task 1 [Transfer money between accounts]


-- step 1 : deduct money from sender account
UPDATE accounts
    SET balance = balance-1500
    WHERE account_holder_name = 'allu';

SELECT * FROM accounts;
+----------------+---------------------+---------+
| account_number | account_holder_name | balance |
+----------------+---------------------+---------+
|              1 | ravi                | 2000.00 |
|              2 | kali                | 4000.00 |
|              3 | allu                | 6500.00 |
+----------------+---------------------+---------+


-- step 2: add money to the reciver accounts 
UPDATE accounts
    -> SET balance = balance + 1500
    -> WHERE account_holder_name = 'kali';

SELECT * FROM accounts;
+----------------+---------------------+---------+
| account_number | account_holder_name | balance |
+----------------+---------------------+---------+
|              1 | ravi                | 2000.00 |
|              2 | kali                | 5500.00 |
|              3 | allu                | 6500.00 |
+----------------+---------------------+---------+

-- step 3: insert the transaction data
INSERT INTO transaction
    (from_account, to_account, amount)
    VALUES
    (3,2,1500);

SELECT * FROM transaction;
+----------------+--------------+------------+---------+---------------------+
| transaction_id | from_account | to_account | amount  | transaction_date    |
+----------------+--------------+------------+---------+---------------------+
|              1 |            3 |          2 | 1500.00 | 2026-02-08 18:21:14 |
+----------------+--------------+------------+---------+---------------------+

-- Task 2 [Check balance]

SELECT balance
    FROM accounts
    WHERE account_number = 3;

+---------+
| balance |
+---------+
| 6500.00 |
+---------+

-- Task 3 [Transaction history]

-- part 1: get all transaction history
SELECT * FROM transaction;
+----------------+--------------+------------+---------+---------------------+
| transaction_id | from_account | to_account | amount  | transaction_date    |
+----------------+--------------+------------+---------+---------------------+
|              1 |            3 |          2 | 1500.00 | 2026-02-08 18:21:14 |
+----------------+--------------+------------+---------+---------------------+

--part 2: get specific transaction history
SELECT * FROM transaction
    WHERE transaction_id = 1;
+----------------+--------------+------------+---------+---------------------+
| transaction_id | from_account | to_account | amount  | transaction_date    |
+----------------+--------------+------------+---------+---------------------+
|              1 |            3 |          2 | 1500.00 | 2026-02-08 18:21:14 |
+----------------+--------------+------------+---------+---------------------+
